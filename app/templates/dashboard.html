{% extends "base.html" %}
{% block title %}Math Dashboard{% endblock %}
{% block content %}
<style>
    .dashboard-wrapper {
        max-width: 800px;
        margin: 3rem auto;
    }

    .card h5 {
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .result-box {
        font-family: monospace;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 0.95rem;
        padding: 0.75rem 1rem;
        background-color: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        color: #212529;
    }
</style>

<div class="dashboard-wrapper">
    <h2 class="mb-4 text-center">Math Operations Dashboard</h2>

    <!-- Power -->
    <div class="card mb-4">
        <div class="card-body d-flex flex-column">
            <h5>Power (x‚Åø)</h5>
            <div class="mb-3 d-flex gap-2 flex-wrap">
                <input type="number" id="pow-base" class="form-control" placeholder="Base" style="max-width: 180px;">
                <input type="number" id="pow-exp" class="form-control" placeholder="Exponent" style="max-width: 180px;">
                <button class="btn btn-dark" onclick="callPower()">Compute</button>
            </div>
            <div id="pow-result" class="result-box d-none"></div>
        </div>
    </div>

    <!-- Fibonacci -->
    <div class="card mb-4">
        <div class="card-body d-flex flex-column">
            <h5>Fibonacci (n-th term)</h5>
            <div class="mb-3 d-flex gap-2 flex-wrap">
                <input type="number" id="fib-n" class="form-control" placeholder="n" style="max-width: 180px;">
                <button class="btn btn-dark" onclick="callFibonacci()">Compute</button>
            </div>
            <div id="fib-result" class="result-box d-none"></div>
        </div>
    </div>

    <!-- Factorial -->
    <div class="card mb-4">
        <div class="card-body d-flex flex-column">
            <h5>Factorial (n!)</h5>
            <div class="mb-3 d-flex gap-2 flex-wrap">
                <input type="number" id="fact-n" class="form-control" placeholder="n" style="max-width: 180px;">
                <button class="btn btn-dark" onclick="callFactorial()">Compute</button>
            </div>
            <div id="fact-result" class="result-box d-none"></div>
        </div>
    </div>
</div>

<script>
    function showResult(elementId, resultText) {
        const el = document.getElementById(elementId);
        el.textContent = resultText; // display full result as-is
        el.classList.remove("d-none");
    }

    async function callPower() {
        const base = document.getElementById("pow-base").value;
        const exponent = document.getElementById("pow-exp").value;

        if (base === "" || exponent === "") {
            showResult("pow-result", "Please enter both base and exponent.");
            return;
        }

        const res = await fetch("/api/math/pow", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ base: Number(base), exponent: Number(exponent) }),
            credentials: "include"
        });

        const data = await res.json();
        const value = data.result !== undefined
            ? data.result.toString()
            : `Error: ${data.error || "Unknown error"}`;
        showResult("pow-result", `Result:\n${value}`);
    }

    async function callFibonacci() {
        const n = document.getElementById("fib-n").value;

        if (n === "") {
            showResult("fib-result", "Please enter a valid number.");
            return;
        }

        const res = await fetch("/api/math/fibonacci", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ n: Number(n) }),
            credentials: "include"
        });

        const data = await res.json();
        const value = data.result !== undefined
            ? data.result.toString()
            : `Error: ${data.error || "Unknown error"}`;
        showResult("fib-result", `Result:\n${value}`);
    }

    async function callFactorial() {
        const n = document.getElementById("fact-n").value;

        if (n === "") {
            showResult("fact-result", "Please enter a valid number.");
            return;
        }

        const res = await fetch("/api/math/factorial", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ n: Number(n) }),
            credentials: "include"
        });

        const data = await res.json();
        const value = data.result !== undefined
            ? data.result.toString()
            : `Error: ${data.error || "Unknown error"}`;
        showResult("fact-result", `Result:\n${value}`);
    }
</script>

{% endblock %}
